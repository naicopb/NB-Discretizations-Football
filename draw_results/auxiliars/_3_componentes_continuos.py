#para cada temporada cojo la clasificación histórica y asocio
#temporada, equipo, ptos porcentaje, empates porcentaje

from pymongo import MongoClient
from datetime import datetime
import numpy as np
from sklearn.cluster import KMeans
from sklearn.metrics import pairwise_distances_argmin_min
from decimal import Decimal


client = MongoClient('localhost:27017')
db = client.primera_y_segunda

def main():
    liga = 'primera_division'
    historical = convertInArray(getHistorical('primera_division'))
    arrayRespuesta = []
    neoArray = []
    for temporada in ['2012-2013', '2013-2014', '2014-2015', '2015-2016', '2016-2017', '2017-2018', '2018-2019', '2019-2020', '2020-2021', '2021-2022']:
        neoArray = crearArrayConClasificaciones(getElementsDeTemporada(historical, temporada))
        otroArray = addNode1(neoArray, liga)
        for i in range(0, len(otroArray)):
            otroArray[i]['position_historical'] = i + 1
            otroArray[i]['puntos'] = 0
            for element in neoArray:
                if element['homeTeam'] == otroArray[i]['team'] and element['winner'] == 'H':
                    otroArray[i]['puntos'] += 3
                if element['awayTeam'] == otroArray[i]['team'] and element['winner'] == 'A':
                    otroArray[i]['puntos'] += 3
                if (element['awayTeam'] == otroArray[i]['team'] or element['homeTeam'] == otroArray[i]['team']) and element['winner'] == 'D':
                    otroArray[i]['puntos'] += 1
                if element['homeTeam'] == otroArray[i]['team']:
                    element['node1_homeTeam_position'] = otroArray[i]['position_historical']
                if element['awayTeam'] == otroArray[i]['team']:
                    element['node1_awayTeam_position'] = otroArray[i]['position_historical']


        #Solo quiero entrar aquí una vez, aquí voy a crear la claificación actual
        arrayParaClasificacionActual = getArrayParaClasificacionActual(neoArray)
        for element in neoArray:
            arrayParaClasificacionActual = actualizaClasificacion(arrayParaClasificacionActual)
            for i in range(0, len(arrayParaClasificacionActual)):
                if element['homeTeam'] == arrayParaClasificacionActual[i]['team']:
                    element['node2_homeTeam_position'] = arrayParaClasificacionActual[i]['position_actual']
                    if arrayParaClasificacionActual[i]['numeroPartidosDisputados'] == 0:
                        element['node3_goals_expectative'] += 0
                    else:
                        element['node3_goals_expectative'] += arrayParaClasificacionActual[i]['golesMarcados']/arrayParaClasificacionActual[i]['numeroPartidosDisputados']
                    arrayParaClasificacionActual[i]['numeroPartidosDisputados'] += 1
                    arrayParaClasificacionActual[i]['diferenciaDeGoles'] += int(element['FTHG']) - int(element['FTAG'])
                    arrayParaClasificacionActual[i]['golesMarcados'] += int(element['FTHG'])
                    if element['winner'] == 'H':
                        arrayParaClasificacionActual[i]['puntos'] += 3
                    if element['winner'] == 'D':
                        arrayParaClasificacionActual[i]['puntos'] += 1
                if element['awayTeam'] == arrayParaClasificacionActual[i]['team']:
                    element['node2_awayTeam_position'] = arrayParaClasificacionActual[i]['position_actual']
                    if arrayParaClasificacionActual[i]['numeroPartidosDisputados'] == 0:
                        element['node3_goals_expectative'] += 0
                    else:
                        element['node3_goals_expectative'] += arrayParaClasificacionActual[i]['golesMarcados']/arrayParaClasificacionActual[i]['numeroPartidosDisputados']
                    arrayParaClasificacionActual[i]['numeroPartidosDisputados'] += 1
                    arrayParaClasificacionActual[i]['diferenciaDeGoles'] += int(element['FTAG']) - int(element['FTHG'])
                    arrayParaClasificacionActual[i]['golesMarcados'] += int(element['FTAG'])
                    if element['winner'] == 'A':
                        arrayParaClasificacionActual[i]['puntos'] += 3
                    if element['winner'] == 'D':
                        arrayParaClasificacionActual[i]['puntos'] += 1
        arrayRespuesta = addElementsDe(arrayRespuesta, neoArray)

    neoArray = arrayRespuesta.copy()

    #calculo todas las probabilidades
    if liga == 'primera_division':
        numeroDePartidosAExcepcionar = 29
    elif liga == 'segunda_division':
        numeroDePartidosAExcepcionar = 32

    array_node1_X = []
    array_node1_NX = []
    array_node2_X = []
    array_node2_NX = []
    array_goles_X = []
    array_goles_NX = []

    counterPartidos = 0
    counterEmpates = 0

    for i in range(0, len(neoArray)):
        if neoArray[i]['numero_partido'] > numeroDePartidosAExcepcionar:
            neoArray[i]['probabilidad_total_empate'] = calculaProbabilidad(neoArray[i]['node3_goals_expectative'], array_goles_X, array_goles_NX, neoArray[i]['node1_homeTeam_position'] - neoArray[i]['node1_awayTeam_position'], array_node1_X, array_node1_NX, neoArray[i]['node2_homeTeam_position'] - neoArray[i]['node2_awayTeam_position'], array_node2_X, array_node2_NX, counterEmpates, counterPartidos)
            counterPartidos += 1
            if neoArray[i]['winner'] == 'D':
                array_goles_X.append(neoArray[i]['node3_goals_expectative'])
                array_node1_X.append(neoArray[i]['node1_homeTeam_position'] - neoArray[i]['node1_awayTeam_position'])
                array_node2_X.append(neoArray[i]['node2_homeTeam_position'] - neoArray[i]['node2_awayTeam_position'])
                counterEmpates += 1
            else:
                array_goles_NX.append(neoArray[i]['node3_goals_expectative'])
                array_node1_NX.append(neoArray[i]['node1_homeTeam_position'] - neoArray[i]['node1_awayTeam_position'])
                array_node2_NX.append(neoArray[i]['node2_homeTeam_position'] - neoArray[i]['node2_awayTeam_position'])
        else:
            neoArray[i]['probabilidad_total_empate'] = 0
    #print(neoArray)
    return neoArray

def addElementsDe(arrayOriginal, arrayParaAdd):
    for element in arrayParaAdd:
        arrayOriginal.append(element)
    return arrayOriginal

def addClasiffications(array, particiones):
    for i in range(0, len(array)):
        array[i]['node1_homeTeam_rango'] = 0
        array[i]['node2_homeTeam_rango'] = 0
        array[i]['node1_awayTeam_rango'] = 0
        array[i]['node2_awayTeam_rango'] = 0
        for j in range(0, len(particiones)):
            for k in range(0, len(particiones[j])):
                if array[i]['node1_homeTeam_position']  == particiones[j][k]:
                    array[i]['node1_homeTeam_rango'] = j
                if array[i]['node2_homeTeam_position'] == particiones[j][k]:
                    array[i]['node2_homeTeam_rango'] = j
                if array[i]['node1_awayTeam_position'] == particiones[j][k]:
                    array[i]['node1_awayTeam_rango'] = j
                if array[i]['node2_awayTeam_position']  == particiones[j][k]:
                    array[i]['node2_awayTeam_rango'] = j
    return array

def calculadorDelCalculadorDeAciertos(neoArray):
    array_de_weeks = [1108, 1110, 1112, 1114, 1116, 1117, 1118, 1119, 1120, 1121, 1122, 1124, 1126, 1128, 1129, 1130, 1132, 1134, 1136, 1138, 1140, 1142, 1144, 1148, 1151, 1152, 1154, 1156, 1158, 1160, 1162, 1164, 1166, 1193, 1194, 1195, 1196, 1197, 1198, 1199, 1200, 1201, 1202, 1203, 1204, 1220, 1222, 1224, 1225, 1226, 1228, 1230, 1231, 1232, 1233, 1234, 1236, 1238, 1240, 1241, 1242, 1243, 1244, 1245, 1246, 1248, 1249, 1251, 1252, 1254, 1257, 1258, 1260, 1262, 1264, 1266, 1268, 1270, 1272, 1274, 1276, 1277, 1278, 1280, 1282, 1283, 1284, 1286, 1288, 1289, 1290, 1291, 1292, 1294, 1316, 1318, 1320, 1322, 1324, 1326, 1327, 1328, 1330, 1332, 1334, 1335, 1336, 1337, 1338, 1339, 1340, 1342, 1344, 1346, 1348, 1350, 1352, 1356, 1358, 1361, 1362, 1364, 1366, 1368, 1370, 1372, 1374, 1376, 1378, 1380, 1382, 1384, 1386, 1387, 1388, 1390, 1392, 1393, 1394, 1396, 1398]
    array_de_aciertos = []
    otraCosaParaComparar = []
    for week in array_de_weeks:
        neoArray = []
        counter_para_week = 0
        for elemento in neoArray:
            if elemento['week'] == week:
                neoArray.append(elemento)
                counter_para_week += 1
        if counter_para_week > 4:
            neoArray = acortarArray(sorted(neoArray, key=lambda x: -x['probabilidad_total_empate']))
            array_de_aciertos.append(calculaAciertos(neoArray))
            for cosa in neoArray:
                otraCosaParaComparar.append(cosa)
    return array_de_aciertos

def calculaAciertos(array):
    counter = 0
    for element in array:
        if element['winner'] == 'D' and element['B365D'] != '':
            counter += float(element['B365D'])
        if element['B365D'] == '':
            counter += 3
    return counter

def acortarArray(array):
    return [array[0], array[1], array[2]]

def calculaProbabilidad(golesDelPartido, array_goles_X, array_goles_NX, diferenciaPosicionesNode1, array_node1_X, array_node1_NX, diferenciaPosicionesNode2, array_node2_X, array_node2_NX, empatesTotales, partidosTotales):
    probGoles_X = calculaProbabilidadContinuaGoles(golesDelPartido, array_goles_X)/(calculaProbabilidadContinuaGoles(golesDelPartido, array_goles_X)+calculaProbabilidadContinuaGoles(golesDelPartido, array_goles_NX))
    probGoles_NX = calculaProbabilidadContinuaGoles(golesDelPartido, array_goles_NX)/(calculaProbabilidadContinuaGoles(golesDelPartido, array_goles_X)+calculaProbabilidadContinuaGoles(golesDelPartido, array_goles_NX))

    probDiferenciaPosicionesNode1_X = calculaProbabilidadContinuaGoles(diferenciaPosicionesNode1, array_node1_X)/(calculaProbabilidadContinuaGoles(diferenciaPosicionesNode1, array_node1_X)+calculaProbabilidadContinuaGoles(diferenciaPosicionesNode1, array_node1_NX))
    probDiferenciaPosicionesNode1_NX = calculaProbabilidadContinuaGoles(diferenciaPosicionesNode1, array_node1_NX)/(calculaProbabilidadContinuaGoles(diferenciaPosicionesNode1, array_node1_X)+calculaProbabilidadContinuaGoles(diferenciaPosicionesNode1, array_node1_NX))

    probDiferenciaPosicionesNode2_X = calculaProbabilidadContinuaGoles(diferenciaPosicionesNode2, array_node2_X)/(calculaProbabilidadContinuaGoles(diferenciaPosicionesNode2, array_node2_X)+calculaProbabilidadContinuaGoles(diferenciaPosicionesNode2, array_node2_NX))
    probDiferenciaPosicionesNode2_NX = calculaProbabilidadContinuaGoles(diferenciaPosicionesNode2, array_node2_NX)/(calculaProbabilidadContinuaGoles(diferenciaPosicionesNode2, array_node2_X)+calculaProbabilidadContinuaGoles(diferenciaPosicionesNode2, array_node2_NX))

    if partidosTotales == 0:
        return 0
    numerador = (empatesTotales/partidosTotales)*probGoles_X*probDiferenciaPosicionesNode1_X*probDiferenciaPosicionesNode2_X
    denominador1 = (empatesTotales/partidosTotales)*probGoles_X*probDiferenciaPosicionesNode1_X*probDiferenciaPosicionesNode2_X
    denominador2 = ((partidosTotales-empatesTotales)/partidosTotales)*probGoles_NX*probDiferenciaPosicionesNode1_NX*probDiferenciaPosicionesNode2_NX
    if denominador1 == 0 and denominador2 == 0:
        return 0
    return numerador/(denominador1+denominador2)

def calculaProbabilidadContinuaGoles(goles, array):
    return (1/(np.sqrt(2*np.var(array)*np.pi)))*np.exp(-((pow((goles-np.mean(array)), 2))/(2*np.var(array))))


def actualizaClasificacion(array):
    for i in range(0, len(array)):
        if array[i]['numeroPartidosDisputados'] < 1:
            return array
        array[i]['porcentajeDePuntos'] = array[i]['puntos']/(array[i]['numeroPartidosDisputados']*3)
        array[i]['porcentajeGolesMarcados'] = array[i]['golesMarcados']/array[i]['numeroPartidosDisputados']

    array = sorted(array, key=lambda x: (-x['porcentajeDePuntos'], -x['diferenciaDeGoles']))
    for i in range(0, len(array)):
        array[i]['position_actual'] = i
    return array

def getArrayParaClasificacionActual(array):
    array_de_equipos = getArrayEquipos(array)
    neoArray = []
    for i in range(0, len(array_de_equipos)):
        object = {}
        object['team'] = array_de_equipos[i]
        object['puntos'] = 0
        object['numeroPartidosDisputados'] = 0
        object['diferenciaDeGoles'] = 0
        object['golesMarcados'] = 0
        object['porcentajeGolesMarcados'] = 0
        object['position_actual'] = i
        neoArray.append(object)
    return neoArray


def addNode1(array, liga):
    if liga == 'primera_division':
        arrayDeClasificacionesHistoricas = [{'team': 'Real Madrid', '2021-2022': 0.7657657657657657, '2020-2021': 0.7297297297297297, '2019-2020': 0.7747747747747747, '2018-2019': 0.6126126126126126, '2017-2018': 0.6756756756756757, '2016-2017': 0.8108108108108109, '2015-2016': 0.7837837837837838, '2014-2015': 0.8018018018018018, '2013-2014': 0.7567567567567568, '2012-2013': 0.7387387387387387, '2011-2012': 0.8738738738738738, '2010-2011': 0.8018018018018018}, {'team': 'Betis', '2021-2022': 0.5765765765765766, '2020-2021': 0.5225225225225225, '2019-2020': 0.36936936936936937, '2018-2019': 0.42342342342342343, '2017-2018': 0.5405405405405406, '2016-2017': 0.34234234234234234, '2015-2016': 0.3783783783783784, '2013-2014': 0.22522522522522523, '2012-2013': 0.4954954954954955, '2011-2012': 0.4144144144144144, '2014-2015': 0.35535535535535534, '2010-2011': 0.35535535535535534}, {'team': 'Vallecano', '2021-2022': 0.3783783783783784, '2018-2019': 0.27927927927927926, '2015-2016': 0.3153153153153153, '2014-2015': 0.44144144144144143, '2013-2014': 0.38738738738738737, '2012-2013': 0.46846846846846846, '2011-2012': 0.36036036036036034, '2020-2021': 0.35535535535535534, '2019-2020': 0.35535535535535534, '2017-2018': 0.35535535535535534, '2016-2017': 0.35535535535535534, '2010-2011': 0.35535535535535534}, {'team': 'Levante', '2021-2022': 0.2882882882882883, '2020-2021': 0.36036036036036034, '2019-2020': 0.4144144144144144, '2018-2019': 0.38738738738738737, '2017-2018': 0.4144144144144144, '2015-2016': 0.2882882882882883, '2014-2015': 0.32432432432432434, '2013-2014': 0.43243243243243246, '2012-2013': 0.40540540540540543, '2011-2012': 0.46846846846846846, '2010-2011': 0.40540540540540543, '2016-2017': 0.35535535535535534}, {'team': 'Valencia', '2021-2022': 0.40540540540540543, '2020-2021': 0.3783783783783784, '2019-2020': 0.4774774774774775, '2018-2019': 0.5225225225225225, '2017-2018': 0.6306306306306306, '2016-2017': 0.4144144144144144, '2015-2016': 0.3963963963963964, '2014-2015': 0.6666666666666666, '2013-2014': 0.4144144144144144, '2012-2013': 0.5855855855855856, '2011-2012': 0.5495495495495496, '2010-2011': 0.6126126126126126}, {'team': 'Celta', '2021-2022': 0.4144144144144144, '2020-2021': 0.4774774774774775, '2019-2020': 0.32432432432432434, '2018-2019': 0.36036036036036034, '2017-2018': 0.4144144144144144, '2016-2017': 0.3963963963963964, '2015-2016': 0.5405405405405406, '2014-2015': 0.43243243243243246, '2013-2014': 0.44144144144144143, '2012-2013': 0.3063063063063063, '2011-2012': 0.35535535535535534, '2010-2011': 0.35535535535535534}, {'team': 'Elche', '2021-2022': 0.35135135135135137, '2020-2021': 0.2972972972972973, '2014-2015': 0.36036036036036034, '2013-2014': 0.36036036036036034, '2019-2020': 0.35535535535535534, '2018-2019': 0.35535535535535534, '2017-2018': 0.35535535535535534, '2016-2017': 0.35535535535535534, '2015-2016': 0.35535535535535534, '2012-2013': 0.35535535535535534, '2011-2012': 0.35535535535535534, '2010-2011': 0.35535535535535534}, {'team': 'Getafe', '2021-2022': 0.35135135135135137, '2020-2021': 0.3333333333333333, '2019-2020': 0.4864864864864865, '2018-2019': 0.5225225225225225, '2017-2018': 0.46846846846846846, '2015-2016': 0.32432432432432434, '2014-2015': 0.3333333333333333, '2013-2014': 0.35135135135135137, '2012-2013': 0.42342342342342343, '2011-2012': 0.42342342342342343, '2010-2011': 0.38738738738738737, '2016-2017': 0.35535535535535534}, {'team': 'Alaves', '2021-2022': 0.27927927927927926, '2020-2021': 0.34234234234234234, '2019-2020': 0.35135135135135137, '2018-2019': 0.42342342342342343, '2017-2018': 0.42342342342342343, '2016-2017': 0.4864864864864865, '2015-2016': 0.35535535535535534, '2014-2015': 0.35535535535535534, '2013-2014': 0.35535535535535534, '2012-2013': 0.35535535535535534, '2011-2012': 0.35535535535535534, '2010-2011': 0.35535535535535534}, {'team': 'Cadiz', '2021-2022': 0.32432432432432434, '2020-2021': 0.38738738738738737, '2019-2020': 0.35535535535535534, '2018-2019': 0.35535535535535534, '2017-2018': 0.35535535535535534, '2016-2017': 0.35535535535535534, '2015-2016': 0.35535535535535534, '2014-2015': 0.35535535535535534, '2013-2014': 0.35535535535535534, '2012-2013': 0.35535535535535534, '2011-2012': 0.35535535535535534, '2010-2011': 0.35535535535535534}, {'team': 'Granada', '2021-2022': 0.3333333333333333, '2020-2021': 0.40540540540540543, '2019-2020': 0.4774774774774775, '2016-2017': 0.18018018018018017, '2015-2016': 0.35135135135135137, '2014-2015': 0.3063063063063063, '2013-2014': 0.34234234234234234, '2012-2013': 0.35135135135135137, '2011-2012': 0.3783783783783784, '2018-2019': 0.35535535535535534, '2017-2018': 0.35535535535535534, '2010-2011': 0.35535535535535534}, {'team': 'Espanol', '2021-2022': 0.36936936936936937, '2019-2020': 0.21621621621621623, '2018-2019': 0.45045045045045046, '2017-2018': 0.4144144144144144, '2016-2017': 0.4774774774774775, '2015-2016': 0.36036036036036034, '2014-2015': 0.44144144144144143, '2013-2014': 0.3783783783783784, '2012-2013': 0.3963963963963964, '2011-2012': 0.40540540540540543, '2010-2011': 0.44144144144144143, '2020-2021': 0.35535535535535534}, {'team': 'Osasuna', '2021-2022': 0.42342342342342343, '2020-2021': 0.3963963963963964, '2019-2020': 0.4594594594594595, '2016-2017': 0.1981981981981982, '2013-2014': 0.32432432432432434, '2012-2013': 0.35135135135135137, '2011-2012': 0.4594594594594595, '2010-2011': 0.3963963963963964, '2018-2019': 0.35535535535535534, '2017-2018': 0.35535535535535534, '2015-2016': 0.35535535535535534, '2014-2015': 0.35535535535535534}, {'team': 'Mallorca', '2021-2022': 0.32432432432432434, '2019-2020': 0.2882882882882883, '2012-2013': 0.2972972972972973, '2011-2012': 0.46846846846846846, '2010-2011': 0.3963963963963964, '2020-2021': 0.35535535535535534, '2018-2019': 0.35535535535535534, '2017-2018': 0.35535535535535534, '2016-2017': 0.35535535535535534, '2015-2016': 0.35535535535535534, '2014-2015': 0.35535535535535534, '2013-2014': 0.35535535535535534}, {'team': 'Barcelona', '2021-2022': 0.6576576576576577, '2020-2021': 0.6846846846846847, '2019-2020': 0.7117117117117117, '2018-2019': 0.7747747747747747, '2017-2018': 0.8108108108108109, '2016-2017': 0.7837837837837838, '2015-2016': 0.7927927927927928, '2014-2015': 0.8378378378378378, '2013-2014': 0.7747747747747747, '2012-2013': 0.8738738738738738, '2011-2012': 0.8108108108108109, '2010-2011': 0.8378378378378378}, {'team': 'Villarreal', '2021-2022': 0.5045045045045045, '2020-2021': 0.5225225225225225, '2019-2020': 0.5135135135135135, '2018-2019': 0.38738738738738737, '2017-2018': 0.5405405405405406, '2016-2017': 0.5765765765765766, '2015-2016': 0.5765765765765766, '2014-2015': 0.5405405405405406, '2013-2014': 0.5045045045045045, '2011-2012': 0.36936936936936937, '2010-2011': 0.5585585585585585, '2012-2013': 0.35535535535535534}, {'team': 'Sevilla', '2021-2022': 0.6036036036036037, '2020-2021': 0.6666666666666666, '2019-2020': 0.6036036036036037, '2018-2019': 0.5045045045045045, '2017-2018': 0.4954954954954955, '2016-2017': 0.6216216216216216, '2015-2016': 0.46846846846846846, '2014-2015': 0.6576576576576577, '2013-2014': 0.5405405405405406, '2012-2013': 0.42342342342342343, '2011-2012': 0.44144144144144143, '2010-2011': 0.4954954954954955}, {'team': 'Ath Bilbao', '2021-2022': 0.4954954954954955, '2020-2021': 0.4144144144144144, '2019-2020': 0.4594594594594595, '2018-2019': 0.4774774774774775, '2017-2018': 0.38738738738738737, '2016-2017': 0.5675675675675675, '2015-2016': 0.5315315315315315, '2014-2015': 0.46846846846846846, '2013-2014': 0.6216216216216216, '2012-2013': 0.3963963963963964, '2011-2012': 0.44144144144144143, '2010-2011': 0.4954954954954955}, {'team': 'Sociedad', '2021-2022': 0.5585585585585585, '2020-2021': 0.5315315315315315, '2019-2020': 0.4954954954954955, '2018-2019': 0.45045045045045046, '2017-2018': 0.44144144144144143, '2016-2017': 0.5675675675675675, '2015-2016': 0.40540540540540543, '2014-2015': 0.38738738738738737, '2013-2014': 0.5315315315315315, '2012-2013': 0.5675675675675675, '2011-2012': 0.3963963963963964, '2010-2011': 0.3963963963963964}, {'team': 'Ath Madrid', '2021-2022': 0.6126126126126126, '2020-2021': 0.7477477477477478, '2019-2020': 0.6216216216216216, '2018-2019': 0.6756756756756757, '2017-2018': 0.7027027027027027, '2016-2017': 0.6756756756756757, '2015-2016': 0.7657657657657657, '2014-2015': 0.6936936936936937, '2013-2014': 0.8018018018018018, '2012-2013': 0.6576576576576577, '2011-2012': 0.4774774774774775, '2010-2011': 0.4954954954954955}, {'team': 'Eibar', '2020-2021': 0.2702702702702703, '2019-2020': 0.3783783783783784, '2018-2019': 0.4144144144144144, '2017-2018': 0.45045045045045046, '2016-2017': 0.4864864864864865, '2015-2016': 0.38738738738738737, '2014-2015': 0.2882882882882883, '2021-2022': 0.35535535535535534, '2013-2014': 0.35535535535535534, '2012-2013': 0.35535535535535534, '2011-2012': 0.35535535535535534, '2010-2011': 0.35535535535535534}, {'team': 'Huesca', '2020-2021': 0.2972972972972973, '2018-2019': 0.2702702702702703, '2021-2022': 0.35535535535535534, '2019-2020': 0.35535535535535534, '2017-2018': 0.35535535535535534, '2016-2017': 0.35535535535535534, '2015-2016': 0.35535535535535534, '2014-2015': 0.35535535535535534, '2013-2014': 0.35535535535535534, '2012-2013': 0.35535535535535534, '2011-2012': 0.35535535535535534, '2010-2011': 0.35535535535535534}, {'team': 'Valladolid', '2020-2021': 0.27927927927927926, '2019-2020': 0.35135135135135137, '2018-2019': 0.36936936936936937, '2013-2014': 0.32432432432432434, '2012-2013': 0.38738738738738737, '2021-2022': 0.35535535535535534, '2017-2018': 0.35535535535535534, '2016-2017': 0.35535535535535534, '2015-2016': 0.35535535535535534, '2014-2015': 0.35535535535535534, '2011-2012': 0.35535535535535534, '2010-2011': 0.35535535535535534}, {'team': 'Leganes', '2019-2020': 0.3153153153153153, '2018-2019': 0.40540540540540543, '2017-2018': 0.36036036036036034, '2016-2017': 0.3063063063063063, '2021-2022': 0.35535535535535534, '2020-2021': 0.35535535535535534, '2015-2016': 0.35535535535535534, '2014-2015': 0.35535535535535534, '2013-2014': 0.35535535535535534, '2012-2013': 0.35535535535535534, '2011-2012': 0.35535535535535534, '2010-2011': 0.35535535535535534}, {'team': 'Girona', '2018-2019': 0.3333333333333333, '2017-2018': 0.43243243243243246, '2021-2022': 0.35535535535535534, '2020-2021': 0.35535535535535534, '2019-2020': 0.35535535535535534, '2016-2017': 0.35535535535535534, '2015-2016': 0.35535535535535534, '2014-2015': 0.35535535535535534, '2013-2014': 0.35535535535535534, '2012-2013': 0.35535535535535534, '2011-2012': 0.35535535535535534, '2010-2011': 0.35535535535535534}, {'team': 'Las Palmas', '2017-2018': 0.1981981981981982, '2016-2017': 0.35135135135135137, '2015-2016': 0.3963963963963964, '2021-2022': 0.35535535535535534, '2020-2021': 0.35535535535535534, '2019-2020': 0.35535535535535534, '2018-2019': 0.35535535535535534, '2014-2015': 0.35535535535535534, '2013-2014': 0.35535535535535534, '2012-2013': 0.35535535535535534, '2011-2012': 0.35535535535535534, '2010-2011': 0.35535535535535534}, {'team': 'Malaga', '2017-2018': 0.18018018018018017, '2016-2017': 0.4144144144144144, '2015-2016': 0.40540540540540543, '2014-2015': 0.45045045045045046, '2013-2014': 0.3783783783783784, '2012-2013': 0.5135135135135135, '2011-2012': 0.4954954954954955, '2010-2011': 0.4144144144144144, '2021-2022': 0.35535535535535534, '2020-2021': 0.35535535535535534, '2019-2020': 0.35535535535535534, '2018-2019': 0.35535535535535534}, {'team': 'La Coruna', '2017-2018': 0.26126126126126126, '2016-2017': 0.2972972972972973, '2015-2016': 0.3783783783783784, '2014-2015': 0.3063063063063063, '2012-2013': 0.3153153153153153, '2010-2011': 0.38738738738738737, '2021-2022': 0.35535535535535534, '2020-2021': 0.35535535535535534, '2019-2020': 0.35535535535535534, '2018-2019': 0.35535535535535534, '2013-2014': 0.35535535535535534, '2011-2012': 0.35535535535535534}, {'team': 'Sp Gijon', '2016-2017': 0.2702702702702703, '2015-2016': 0.32432432432432434, '2011-2012': 0.3333333333333333, '2010-2011': 0.4144144144144144, '2021-2022': 0.35535535535535534, '2020-2021': 0.35535535535535534, '2019-2020': 0.35535535535535534, '2018-2019': 0.35535535535535534, '2017-2018': 0.35535535535535534, '2014-2015': 0.35535535535535534, '2013-2014': 0.35535535535535534, '2012-2013': 0.35535535535535534}, {'team': 'Almeria', '2014-2015': 0.2882882882882883, '2013-2014': 0.35135135135135137, '2010-2011': 0.2702702702702703, '2021-2022': 0.35535535535535534, '2020-2021': 0.35535535535535534, '2019-2020': 0.35535535535535534, '2018-2019': 0.35535535535535534, '2017-2018': 0.35535535535535534, '2016-2017': 0.35535535535535534, '2015-2016': 0.35535535535535534, '2012-2013': 0.35535535535535534, '2011-2012': 0.35535535535535534}, {'team': 'Cordoba', '2014-2015': 0.18018018018018017, '2021-2022': 0.35535535535535534, '2020-2021': 0.35535535535535534, '2019-2020': 0.35535535535535534, '2018-2019': 0.35535535535535534, '2017-2018': 0.35535535535535534, '2016-2017': 0.35535535535535534, '2015-2016': 0.35535535535535534, '2013-2014': 0.35535535535535534, '2012-2013': 0.35535535535535534, '2011-2012': 0.35535535535535534, '2010-2011': 0.35535535535535534}, {'team': 'Zaragoza', '2012-2013': 0.3063063063063063, '2011-2012': 0.36036036036036034, '2010-2011': 0.3783783783783784, '2021-2022': 0.35535535535535534, '2020-2021': 0.35535535535535534, '2019-2020': 0.35535535535535534, '2018-2019': 0.35535535535535534, '2017-2018': 0.35535535535535534, '2016-2017': 0.35535535535535534, '2015-2016': 0.35535535535535534, '2014-2015': 0.35535535535535534, '2013-2014': 0.35535535535535534}, {'team': 'Santander', '2011-2012': 0.24324324324324326, '2010-2011': 0.4144144144144144, '2021-2022': 0.35535535535535534, '2020-2021': 0.35535535535535534, '2019-2020': 0.35535535535535534, '2018-2019': 0.35535535535535534, '2017-2018': 0.35535535535535534, '2016-2017': 0.35535535535535534, '2015-2016': 0.35535535535535534, '2014-2015': 0.35535535535535534, '2013-2014': 0.35535535535535534, '2012-2013': 0.35535535535535534}, {'team': 'Hercules', '2010-2011': 0.3063063063063063, '2021-2022': 0.35535535535535534, '2020-2021': 0.35535535535535534, '2019-2020': 0.35535535535535534, '2018-2019': 0.35535535535535534, '2017-2018': 0.35535535535535534, '2016-2017': 0.35535535535535534, '2015-2016': 0.35535535535535534, '2014-2015': 0.35535535535535534, '2013-2014': 0.35535535535535534, '2012-2013': 0.35535535535535534, '2011-2012': 0.35535535535535534}]
    elif liga == 'segunda_division':
        arrayDeClasificacionesHistoricas = [{'team': 'Las Palmas', '2021-2022': 0.4954954954954955, '2020-2021': 0.44144144144144143, '2019-2020': 0.42342342342342343, '2018-2019': 0.4144144144144144, '2014-2015': 0.5675675675675675, '2013-2014': 0.5135135135135135, '2012-2013': 0.5495495495495496, '2011-2012': 0.44144144144144143, '2010-2011': 0.3963963963963964, '2017-2018': 0.45788645788645793, '2016-2017': 0.45788645788645793, '2015-2016': 0.45788645788645793}, {'team': 'Malaga', '2021-2022': 0.36936936936936937, '2020-2021': 0.44144144144144143, '2019-2020': 0.40540540540540543, '2018-2019': 0.5315315315315315, '2017-2018': 0.45788645788645793, '2016-2017': 0.45788645788645793, '2015-2016': 0.45788645788645793, '2014-2015': 0.45788645788645793, '2013-2014': 0.45788645788645793, '2012-2013': 0.45788645788645793, '2011-2012': 0.45788645788645793, '2010-2011': 0.45788645788645793}, {'team': 'Oviedo', '2021-2022': 0.5405405405405406, '2020-2021': 0.3963963963963964, '2019-2020': 0.3963963963963964, '2018-2019': 0.5135135135135135, '2017-2018': 0.5045045045045045, '2016-2017': 0.4774774774774775, '2015-2016': 0.5045045045045045, '2014-2015': 0.45788645788645793, '2013-2014': 0.45788645788645793, '2012-2013': 0.45788645788645793, '2011-2012': 0.45788645788645793, '2010-2011': 0.45788645788645793}, {'team': 'Mirandes', '2021-2022': 0.4144144144144144, '2020-2021': 0.44144144144144143, '2019-2020': 0.44144144144144143, '2016-2017': 0.2972972972972973, '2015-2016': 0.4594594594594595, '2014-2015': 0.42342342342342343, '2013-2014': 0.44144144144144143, '2012-2013': 0.3783783783783784, '2018-2019': 0.45788645788645793, '2017-2018': 0.45788645788645793, '2011-2012': 0.45788645788645793, '2010-2011': 0.45788645788645793}, {'team': 'Eibar', '2021-2022': 0.6396396396396397, '2013-2014': 0.5585585585585585, '2020-2021': 0.45788645788645793, '2019-2020': 0.45788645788645793, '2018-2019': 0.45788645788645793, '2017-2018': 0.45788645788645793, '2016-2017': 0.45788645788645793, '2015-2016': 0.45788645788645793, '2014-2015': 0.45788645788645793, '2012-2013': 0.45788645788645793, '2011-2012': 0.45788645788645793, '2010-2011': 0.45788645788645793}, {'team': 'Zaragoza', '2021-2022': 0.44144144144144143, '2020-2021': 0.36936936936936937, '2019-2020': 0.5495495495495496, '2018-2019': 0.3963963963963964, '2017-2018': 0.5315315315315315, '2016-2017': 0.4144144144144144, '2015-2016': 0.5315315315315315, '2014-2015': 0.5045045045045045, '2013-2014': 0.42342342342342343, '2012-2013': 0.45788645788645793, '2011-2012': 0.45788645788645793, '2010-2011': 0.45788645788645793}, {'team': 'Burgos', '2021-2022': 0.45045045045045046, '2020-2021': 0.45788645788645793, '2019-2020': 0.45788645788645793, '2018-2019': 0.45788645788645793, '2017-2018': 0.45788645788645793, '2016-2017': 0.45788645788645793, '2015-2016': 0.45788645788645793, '2014-2015': 0.45788645788645793, '2013-2014': 0.45788645788645793, '2012-2013': 0.45788645788645793, '2011-2012': 0.45788645788645793, '2010-2011': 0.45788645788645793}, {'team': 'Almeria', '2021-2022': 0.6306306306306306, '2020-2021': 0.5675675675675675, '2019-2020': 0.5405405405405406, '2018-2019': 0.46846846846846846, '2017-2018': 0.3783783783783784, '2016-2017': 0.3783783783783784, '2015-2016': 0.36036036036036034, '2012-2013': 0.5585585585585585, '2011-2012': 0.5225225225225225, '2014-2015': 0.45788645788645793, '2013-2014': 0.45788645788645793, '2010-2011': 0.45788645788645793}, {'team': 'Amorebieta', '2021-2022': 0.3063063063063063, '2020-2021': 0.45788645788645793, '2019-2020': 0.45788645788645793, '2018-2019': 0.45788645788645793, '2017-2018': 0.45788645788645793, '2016-2017': 0.45788645788645793, '2015-2016': 0.45788645788645793, '2014-2015': 0.45788645788645793, '2013-2014': 0.45788645788645793, '2012-2013': 0.45788645788645793, '2011-2012': 0.45788645788645793, '2010-2011': 0.45788645788645793}, {'team': 'Fuenlabrada', '2021-2022': 0.26126126126126126, '2020-2021': 0.45045045045045046, '2019-2020': 0.45045045045045046, '2018-2019': 0.45788645788645793, '2017-2018': 0.45788645788645793, '2016-2017': 0.45788645788645793, '2015-2016': 0.45788645788645793, '2014-2015': 0.45788645788645793, '2013-2014': 0.45788645788645793, '2012-2013': 0.45788645788645793, '2011-2012': 0.45788645788645793, '2010-2011': 0.45788645788645793}, {'team': 'Alcorcon', '2021-2022': 0.1981981981981982, '2020-2021': 0.3783783783783784, '2019-2020': 0.46846846846846846, '2018-2019': 0.4594594594594595, '2017-2018': 0.38738738738738737, '2016-2017': 0.36036036036036034, '2015-2016': 0.4954954954954955, '2014-2015': 0.45045045045045046, '2013-2014': 0.42342342342342343, '2012-2013': 0.5855855855855856, '2011-2012': 0.5675675675675675, '2010-2011': 0.45045045045045046}, {'team': 'Girona', '2021-2022': 0.5495495495495496, '2020-2021': 0.5225225225225225, '2019-2020': 0.4954954954954955, '2016-2017': 0.6126126126126126, '2015-2016': 0.4954954954954955, '2014-2015': 0.6396396396396397, '2013-2014': 0.38738738738738737, '2012-2013': 0.6036036036036037, '2011-2012': 0.34234234234234234, '2010-2011': 0.4594594594594595, '2018-2019': 0.45788645788645793, '2017-2018': 0.45788645788645793}, {'team': 'Sp Gijon', '2021-2022': 0.36936936936936937, '2020-2021': 0.5225225225225225, '2019-2020': 0.44144144144144143, '2018-2019': 0.4864864864864865, '2017-2018': 0.6126126126126126, '2014-2015': 0.6216216216216216, '2013-2014': 0.4774774774774775, '2012-2013': 0.44144144144144143, '2016-2017': 0.45788645788645793, '2015-2016': 0.45788645788645793, '2011-2012': 0.45788645788645793, '2010-2011': 0.45788645788645793}, {'team': 'Ibiza', '2021-2022': 0.43243243243243246, '2020-2021': 0.45788645788645793, '2019-2020': 0.45788645788645793, '2018-2019': 0.45788645788645793, '2017-2018': 0.45788645788645793, '2016-2017': 0.45788645788645793, '2015-2016': 0.45788645788645793, '2014-2015': 0.45788645788645793, '2013-2014': 0.45788645788645793, '2012-2013': 0.45788645788645793, '2011-2012': 0.45788645788645793, '2010-2011': 0.45788645788645793}, {'team': 'Lugo', '2021-2022': 0.4144144144144144, '2020-2021': 0.3333333333333333, '2019-2020': 0.36936936936936937, '2018-2019': 0.36036036036036034, '2017-2018': 0.45045045045045046, '2016-2017': 0.43243243243243246, '2015-2016': 0.4594594594594595, '2014-2015': 0.4144144144144144, '2013-2014': 0.45045045045045046, '2012-2013': 0.44144144144144143, '2011-2012': 0.45788645788645793, '2010-2011': 0.45788645788645793}, {'team': 'Tenerife', '2021-2022': 0.5675675675675675, '2020-2021': 0.42342342342342343, '2019-2020': 0.45045045045045046, '2018-2019': 0.38738738738738737, '2017-2018': 0.46846846846846846, '2016-2017': 0.5225225225225225, '2015-2016': 0.4594594594594595, '2014-2015': 0.36036036036036034, '2013-2014': 0.4864864864864865, '2010-2011': 0.27927927927927926, '2012-2013': 0.45788645788645793, '2011-2012': 0.45788645788645793}, {'team': 'Ponferradina', '2021-2022': 0.5135135135135135, '2020-2021': 0.4774774774774775, '2019-2020': 0.43243243243243246, '2015-2016': 0.36036036036036034, '2014-2015': 0.4774774774774775, '2013-2014': 0.42342342342342343, '2012-2013': 0.5315315315315315, '2010-2011': 0.25225225225225223, '2018-2019': 0.45788645788645793, '2017-2018': 0.45788645788645793, '2016-2017': 0.45788645788645793, '2011-2012': 0.45788645788645793}, {'team': 'Cartagena', '2021-2022': 0.46846846846846846, '2020-2021': 0.35135135135135137, '2011-2012': 0.2972972972972973, '2010-2011': 0.4774774774774775, '2019-2020': 0.45788645788645793, '2018-2019': 0.45788645788645793, '2017-2018': 0.45788645788645793, '2016-2017': 0.45788645788645793, '2015-2016': 0.45788645788645793, '2014-2015': 0.45788645788645793, '2013-2014': 0.45788645788645793, '2012-2013': 0.45788645788645793}, {'team': 'Leganes', '2021-2022': 0.4144144144144144, '2020-2021': 0.5585585585585585, '2015-2016': 0.5765765765765766, '2014-2015': 0.45045045045045046, '2019-2020': 0.45788645788645793, '2018-2019': 0.45788645788645793, '2017-2018': 0.45788645788645793, '2016-2017': 0.45788645788645793, '2013-2014': 0.45788645788645793, '2012-2013': 0.45788645788645793, '2011-2012': 0.45788645788645793, '2010-2011': 0.45788645788645793}, {'team': 'Huesca', '2021-2022': 0.45045045045045046, '2019-2020': 0.5495495495495496, '2017-2018': 0.6126126126126126, '2016-2017': 0.4954954954954955, '2015-2016': 0.3783783783783784, '2012-2013': 0.32432432432432434, '2011-2012': 0.40540540540540543, '2010-2011': 0.4594594594594595, '2020-2021': 0.45788645788645793, '2018-2019': 0.45788645788645793, '2014-2015': 0.45788645788645793, '2013-2014': 0.45788645788645793}, {'team': 'Valladolid', '2021-2022': 0.6216216216216216, '2017-2018': 0.4954954954954955, '2016-2017': 0.4774774774774775, '2015-2016': 0.4144144144144144, '2014-2015': 0.5855855855855856, '2011-2012': 0.6486486486486487, '2010-2011': 0.5135135135135135, '2020-2021': 0.45788645788645793, '2019-2020': 0.45788645788645793, '2018-2019': 0.45788645788645793, '2013-2014': 0.45788645788645793, '2012-2013': 0.45788645788645793}, {'team': 'Sociedad B', '2021-2022': 0.3063063063063063, '2020-2021': 0.45788645788645793, '2019-2020': 0.45788645788645793, '2018-2019': 0.45788645788645793, '2017-2018': 0.45788645788645793, '2016-2017': 0.45788645788645793, '2015-2016': 0.45788645788645793, '2014-2015': 0.45788645788645793, '2013-2014': 0.45788645788645793, '2012-2013': 0.45788645788645793, '2011-2012': 0.45788645788645793, '2010-2011': 0.45788645788645793}, {'team': 'Albacete', '2020-2021': 0.2972972972972973, '2019-2020': 0.3963963963963964, '2018-2019': 0.5855855855855856, '2017-2018': 0.4144144144144144, '2015-2016': 0.32432432432432434, '2014-2015': 0.3963963963963964, '2010-2011': 0.26126126126126126, '2021-2022': 0.45788645788645793, '2016-2017': 0.45788645788645793, '2013-2014': 0.45788645788645793, '2012-2013': 0.45788645788645793, '2011-2012': 0.45788645788645793}, {'team': 'Espanol', '2020-2021': 0.6936936936936937, '2021-2022': 0.45788645788645793, '2019-2020': 0.45788645788645793, '2018-2019': 0.45788645788645793, '2017-2018': 0.45788645788645793, '2016-2017': 0.45788645788645793, '2015-2016': 0.45788645788645793, '2014-2015': 0.45788645788645793, '2013-2014': 0.45788645788645793, '2012-2013': 0.45788645788645793, '2011-2012': 0.45788645788645793, '2010-2011': 0.45788645788645793}, {'team': 'Mallorca', '2020-2021': 0.6396396396396397, '2018-2019': 0.5765765765765766, '2016-2017': 0.35135135135135137, '2015-2016': 0.36036036036036034, '2014-2015': 0.3783783783783784, '2013-2014': 0.3963963963963964, '2021-2022': 0.45788645788645793, '2019-2020': 0.45788645788645793, '2017-2018': 0.45788645788645793, '2012-2013': 0.45788645788645793, '2011-2012': 0.45788645788645793, '2010-2011': 0.45788645788645793}, {'team': 'Sabadell', '2020-2021': 0.36036036036036034, '2014-2015': 0.32432432432432434, '2013-2014': 0.4594594594594595, '2012-2013': 0.45045045045045046, '2011-2012': 0.38738738738738737, '2021-2022': 0.45788645788645793, '2019-2020': 0.45788645788645793, '2018-2019': 0.45788645788645793, '2017-2018': 0.45788645788645793, '2016-2017': 0.45788645788645793, '2015-2016': 0.45788645788645793, '2010-2011': 0.45788645788645793}, {'team': 'Castellon', '2020-2021': 0.36936936936936937, '2021-2022': 0.45788645788645793, '2019-2020': 0.45788645788645793, '2018-2019': 0.45788645788645793, '2017-2018': 0.45788645788645793, '2016-2017': 0.45788645788645793, '2015-2016': 0.45788645788645793, '2014-2015': 0.45788645788645793, '2013-2014': 0.45788645788645793, '2012-2013': 0.45788645788645793, '2011-2012': 0.45788645788645793, '2010-2011': 0.45788645788645793}, {'team': 'Logrones', '2020-2021': 0.36936936936936937, '2021-2022': 0.45788645788645793, '2019-2020': 0.45788645788645793, '2018-2019': 0.45788645788645793, '2017-2018': 0.45788645788645793, '2016-2017': 0.45788645788645793, '2015-2016': 0.45788645788645793, '2014-2015': 0.45788645788645793, '2013-2014': 0.45788645788645793, '2012-2013': 0.45788645788645793, '2011-2012': 0.45788645788645793, '2010-2011': 0.45788645788645793}, {'team': 'Vallecano', '2020-2021': 0.5135135135135135, '2019-2020': 0.45045045045045046, '2017-2018': 0.6306306306306306, '2016-2017': 0.4144144144144144, '2010-2011': 0.6486486486486487, '2021-2022': 0.45788645788645793, '2018-2019': 0.45788645788645793, '2015-2016': 0.45788645788645793, '2014-2015': 0.45788645788645793, '2013-2014': 0.45788645788645793, '2012-2013': 0.45788645788645793, '2011-2012': 0.45788645788645793}, {'team': 'Numancia', '2019-2020': 0.36936936936936937, '2018-2019': 0.36936936936936937, '2017-2018': 0.5495495495495496, '2016-2017': 0.43243243243243246, '2015-2016': 0.45045045045045046, '2014-2015': 0.45045045045045046, '2013-2014': 0.4144144144144144, '2012-2013': 0.42342342342342343, '2011-2012': 0.43243243243243246, '2010-2011': 0.4144144144144144, '2021-2022': 0.45788645788645793, '2020-2021': 0.45788645788645793}, {'team': 'Extremadura UD', '2019-2020': 0.3333333333333333, '2018-2019': 0.40540540540540543, '2021-2022': 0.45788645788645793, '2020-2021': 0.45788645788645793, '2017-2018': 0.45788645788645793, '2016-2017': 0.45788645788645793, '2015-2016': 0.45788645788645793, '2014-2015': 0.45788645788645793, '2013-2014': 0.45788645788645793, '2012-2013': 0.45788645788645793, '2011-2012': 0.45788645788645793, '2010-2011': 0.45788645788645793}, {'team': 'Santander', '2019-2020': 0.2702702702702703, '2014-2015': 0.34234234234234234, '2012-2013': 0.3153153153153153, '2021-2022': 0.45788645788645793, '2020-2021': 0.45788645788645793, '2018-2019': 0.45788645788645793, '2017-2018': 0.45788645788645793, '2016-2017': 0.45788645788645793, '2015-2016': 0.45788645788645793, '2013-2014': 0.45788645788645793, '2011-2012': 0.45788645788645793, '2010-2011': 0.45788645788645793}, {'team': 'Elche', '2019-2020': 0.46846846846846846, '2018-2019': 0.45045045045045046, '2016-2017': 0.3783783783783784, '2015-2016': 0.4954954954954955, '2012-2013': 0.6846846846846847, '2011-2012': 0.4864864864864865, '2010-2011': 0.5405405405405406, '2021-2022': 0.45788645788645793, '2020-2021': 0.45788645788645793, '2017-2018': 0.45788645788645793, '2014-2015': 0.45788645788645793, '2013-2014': 0.45788645788645793}, {'team': 'Cadiz', '2019-2020': 0.5675675675675675, '2018-2019': 0.5495495495495496, '2017-2018': 0.5315315315315315, '2016-2017': 0.5225225225225225, '2021-2022': 0.45788645788645793, '2020-2021': 0.45788645788645793, '2015-2016': 0.45788645788645793, '2014-2015': 0.45788645788645793, '2013-2014': 0.45788645788645793, '2012-2013': 0.45788645788645793, '2011-2012': 0.45788645788645793, '2010-2011': 0.45788645788645793}, {'team': 'La Coruna', '2019-2020': 0.40540540540540543, '2018-2019': 0.5405405405405406, '2013-2014': 0.5765765765765766, '2011-2012': 0.7117117117117117, '2021-2022': 0.45788645788645793, '2020-2021': 0.45788645788645793, '2017-2018': 0.45788645788645793, '2016-2017': 0.45788645788645793, '2015-2016': 0.45788645788645793, '2014-2015': 0.45788645788645793, '2012-2013': 0.45788645788645793, '2010-2011': 0.45788645788645793}, {'team': 'Granada', '2018-2019': 0.6126126126126126, '2017-2018': 0.4954954954954955, '2010-2011': 0.5405405405405406, '2021-2022': 0.45788645788645793, '2020-2021': 0.45788645788645793, '2019-2020': 0.45788645788645793, '2016-2017': 0.45788645788645793, '2015-2016': 0.45788645788645793, '2014-2015': 0.45788645788645793, '2013-2014': 0.45788645788645793, '2012-2013': 0.45788645788645793, '2011-2012': 0.45788645788645793}, {'team': 'Osasuna', '2018-2019': 0.6666666666666666, '2017-2018': 0.4864864864864865, '2015-2016': 0.5135135135135135, '2014-2015': 0.35135135135135137, '2021-2022': 0.45788645788645793, '2020-2021': 0.45788645788645793, '2019-2020': 0.45788645788645793, '2016-2017': 0.45788645788645793, '2013-2014': 0.45788645788645793, '2012-2013': 0.45788645788645793, '2011-2012': 0.45788645788645793, '2010-2011': 0.45788645788645793}, {'team': 'Reus Deportiu', '2018-2019': 0.1891891891891892, '2017-2018': 0.43243243243243246, '2016-2017': 0.43243243243243246, '2021-2022': 0.45788645788645793, '2020-2021': 0.45788645788645793, '2019-2020': 0.45788645788645793, '2015-2016': 0.45788645788645793, '2014-2015': 0.45788645788645793, '2013-2014': 0.45788645788645793, '2012-2013': 0.45788645788645793, '2011-2012': 0.45788645788645793, '2010-2011': 0.45788645788645793}, {'team': 'Gimnastic', '2018-2019': 0.25225225225225223, '2017-2018': 0.38738738738738737, '2016-2017': 0.3783783783783784, '2015-2016': 0.5405405405405406, '2011-2012': 0.26126126126126126, '2010-2011': 0.3783783783783784, '2021-2022': 0.45788645788645793, '2020-2021': 0.45788645788645793, '2019-2020': 0.45788645788645793, '2014-2015': 0.45788645788645793, '2013-2014': 0.45788645788645793, '2012-2013': 0.45788645788645793}, {'team': 'Cordoba', '2018-2019': 0.2702702702702703, '2017-2018': 0.35135135135135137, '2016-2017': 0.3783783783783784, '2015-2016': 0.4954954954954955, '2013-2014': 0.4774774774774775, '2012-2013': 0.4774774774774775, '2011-2012': 0.5495495495495496, '2010-2011': 0.4144144144144144, '2021-2022': 0.45788645788645793, '2020-2021': 0.45788645788645793, '2019-2020': 0.45788645788645793, '2014-2015': 0.45788645788645793}, {'team': 'Rayo Majadahonda', '2018-2019': 0.36936936936936937, '2021-2022': 0.45788645788645793, '2020-2021': 0.45788645788645793, '2019-2020': 0.45788645788645793, '2017-2018': 0.45788645788645793, '2016-2017': 0.45788645788645793, '2015-2016': 0.45788645788645793, '2014-2015': 0.45788645788645793, '2013-2014': 0.45788645788645793, '2012-2013': 0.45788645788645793, '2011-2012': 0.45788645788645793, '2010-2011': 0.45788645788645793}, {'team': 'Leonesa', '2017-2018': 0.38738738738738737, '2021-2022': 0.45788645788645793, '2020-2021': 0.45788645788645793, '2019-2020': 0.45788645788645793, '2018-2019': 0.45788645788645793, '2016-2017': 0.45788645788645793, '2015-2016': 0.45788645788645793, '2014-2015': 0.45788645788645793, '2013-2014': 0.45788645788645793, '2012-2013': 0.45788645788645793, '2011-2012': 0.45788645788645793, '2010-2011': 0.45788645788645793}, {'team': 'Barcelona B', '2017-2018': 0.3333333333333333, '2014-2015': 0.2972972972972973, '2013-2014': 0.5135135135135135, '2012-2013': 0.4954954954954955, '2011-2012': 0.4774774774774775, '2010-2011': 0.5495495495495496, '2021-2022': 0.45788645788645793, '2020-2021': 0.45788645788645793, '2019-2020': 0.45788645788645793, '2018-2019': 0.45788645788645793, '2016-2017': 0.45788645788645793, '2015-2016': 0.45788645788645793}, {'team': 'Sevilla B', '2017-2018': 0.23423423423423423, '2016-2017': 0.44144144144144143, '2021-2022': 0.45788645788645793, '2020-2021': 0.45788645788645793, '2019-2020': 0.45788645788645793, '2018-2019': 0.45788645788645793, '2015-2016': 0.45788645788645793, '2014-2015': 0.45788645788645793, '2013-2014': 0.45788645788645793, '2012-2013': 0.45788645788645793, '2011-2012': 0.45788645788645793, '2010-2011': 0.45788645788645793}, {'team': 'Lorca', '2017-2018': 0.24324324324324326, '2021-2022': 0.45788645788645793, '2020-2021': 0.45788645788645793, '2019-2020': 0.45788645788645793, '2018-2019': 0.45788645788645793, '2016-2017': 0.45788645788645793, '2015-2016': 0.45788645788645793, '2014-2015': 0.45788645788645793, '2013-2014': 0.45788645788645793, '2012-2013': 0.45788645788645793, '2011-2012': 0.45788645788645793, '2010-2011': 0.45788645788645793}, {'team': 'Getafe', '2016-2017': 0.5495495495495496, '2021-2022': 0.45788645788645793, '2020-2021': 0.45788645788645793, '2019-2020': 0.45788645788645793, '2018-2019': 0.45788645788645793, '2017-2018': 0.45788645788645793, '2015-2016': 0.45788645788645793, '2014-2015': 0.45788645788645793, '2013-2014': 0.45788645788645793, '2012-2013': 0.45788645788645793, '2011-2012': 0.45788645788645793, '2010-2011': 0.45788645788645793}, {'team': 'Levante', '2016-2017': 0.6936936936936937, '2021-2022': 0.45788645788645793, '2020-2021': 0.45788645788645793, '2019-2020': 0.45788645788645793, '2018-2019': 0.45788645788645793, '2017-2018': 0.45788645788645793, '2015-2016': 0.45788645788645793, '2014-2015': 0.45788645788645793, '2013-2014': 0.45788645788645793, '2012-2013': 0.45788645788645793, '2011-2012': 0.45788645788645793, '2010-2011': 0.45788645788645793}, {'team': 'UCAM Murcia', '2016-2017': 0.3963963963963964, '2021-2022': 0.45788645788645793, '2020-2021': 0.45788645788645793, '2019-2020': 0.45788645788645793, '2018-2019': 0.45788645788645793, '2017-2018': 0.45788645788645793, '2015-2016': 0.45788645788645793, '2014-2015': 0.45788645788645793, '2013-2014': 0.45788645788645793, '2012-2013': 0.45788645788645793, '2011-2012': 0.45788645788645793, '2010-2011': 0.45788645788645793}, {'team': 'Alaves', '2015-2016': 0.5585585585585585, '2014-2015': 0.45045045045045046, '2013-2014': 0.36936936936936937, '2021-2022': 0.45788645788645793, '2020-2021': 0.45788645788645793, '2019-2020': 0.45788645788645793, '2018-2019': 0.45788645788645793, '2017-2018': 0.45788645788645793, '2016-2017': 0.45788645788645793, '2012-2013': 0.45788645788645793, '2011-2012': 0.45788645788645793, '2010-2011': 0.45788645788645793}, {'team': 'Ath Bilbao B', '2015-2016': 0.25225225225225223, '2021-2022': 0.45788645788645793, '2020-2021': 0.45788645788645793, '2019-2020': 0.45788645788645793, '2018-2019': 0.45788645788645793, '2017-2018': 0.45788645788645793, '2016-2017': 0.45788645788645793, '2014-2015': 0.45788645788645793, '2013-2014': 0.45788645788645793, '2012-2013': 0.45788645788645793, '2011-2012': 0.45788645788645793, '2010-2011': 0.45788645788645793}, {'team': 'Llagostera', '2015-2016': 0.32432432432432434, '2014-2015': 0.4594594594594595, '2021-2022': 0.45788645788645793, '2020-2021': 0.45788645788645793, '2019-2020': 0.45788645788645793, '2018-2019': 0.45788645788645793, '2017-2018': 0.45788645788645793, '2016-2017': 0.45788645788645793, '2013-2014': 0.45788645788645793, '2012-2013': 0.45788645788645793, '2011-2012': 0.45788645788645793, '2010-2011': 0.45788645788645793}, {'team': 'Recreativo', '2014-2015': 0.2882882882882883, '2013-2014': 0.4774774774774775, '2012-2013': 0.43243243243243246, '2011-2012': 0.4144144144144144, '2010-2011': 0.45045045045045046, '2021-2022': 0.45788645788645793, '2020-2021': 0.45788645788645793, '2019-2020': 0.45788645788645793, '2018-2019': 0.45788645788645793, '2017-2018': 0.45788645788645793, '2016-2017': 0.45788645788645793, '2015-2016': 0.45788645788645793}, {'team': 'Betis', '2014-2015': 0.6756756756756757, '2010-2011': 0.6576576576576577, '2021-2022': 0.45788645788645793, '2020-2021': 0.45788645788645793, '2019-2020': 0.45788645788645793, '2018-2019': 0.45788645788645793, '2017-2018': 0.45788645788645793, '2016-2017': 0.45788645788645793, '2015-2016': 0.45788645788645793, '2013-2014': 0.45788645788645793, '2012-2013': 0.45788645788645793, '2011-2012': 0.45788645788645793}, {'team': 'Real Madrid B', '2013-2014': 0.3783783783783784, '2012-2013': 0.4594594594594595, '2021-2022': 0.45788645788645793, '2020-2021': 0.45788645788645793, '2019-2020': 0.45788645788645793, '2018-2019': 0.45788645788645793, '2017-2018': 0.45788645788645793, '2016-2017': 0.45788645788645793, '2015-2016': 0.45788645788645793, '2014-2015': 0.45788645788645793, '2011-2012': 0.45788645788645793, '2010-2011': 0.45788645788645793}, {'team': 'Hercules', '2013-2014': 0.36936936936936937, '2012-2013': 0.3963963963963964, '2011-2012': 0.5855855855855856, '2021-2022': 0.45788645788645793, '2020-2021': 0.45788645788645793, '2019-2020': 0.45788645788645793, '2018-2019': 0.45788645788645793, '2017-2018': 0.45788645788645793, '2016-2017': 0.45788645788645793, '2015-2016': 0.45788645788645793, '2014-2015': 0.45788645788645793, '2010-2011': 0.45788645788645793}, {'team': 'Jaen', '2013-2014': 0.3963963963963964, '2021-2022': 0.45788645788645793, '2020-2021': 0.45788645788645793, '2019-2020': 0.45788645788645793, '2018-2019': 0.45788645788645793, '2017-2018': 0.45788645788645793, '2016-2017': 0.45788645788645793, '2015-2016': 0.45788645788645793, '2014-2015': 0.45788645788645793, '2012-2013': 0.45788645788645793, '2011-2012': 0.45788645788645793, '2010-2011': 0.45788645788645793}, {'team': 'Murcia', '2013-2014': 0.4954954954954955, '2012-2013': 0.36036036036036034, '2011-2012': 0.38738738738738737, '2021-2022': 0.45788645788645793, '2020-2021': 0.45788645788645793, '2019-2020': 0.45788645788645793, '2018-2019': 0.45788645788645793, '2017-2018': 0.45788645788645793, '2016-2017': 0.45788645788645793, '2015-2016': 0.45788645788645793, '2014-2015': 0.45788645788645793, '2010-2011': 0.45788645788645793}, {'team': 'Xerez', '2012-2013': 0.21621621621621623, '2011-2012': 0.40540540540540543, '2010-2011': 0.4864864864864865, '2021-2022': 0.45788645788645793, '2020-2021': 0.45788645788645793, '2019-2020': 0.45788645788645793, '2018-2019': 0.45788645788645793, '2017-2018': 0.45788645788645793, '2016-2017': 0.45788645788645793, '2015-2016': 0.45788645788645793, '2014-2015': 0.45788645788645793, '2013-2014': 0.45788645788645793}, {'team': 'Guadalajara', '2012-2013': 0.40540540540540543, '2011-2012': 0.36036036036036034, '2021-2022': 0.45788645788645793, '2020-2021': 0.45788645788645793, '2019-2020': 0.45788645788645793, '2018-2019': 0.45788645788645793, '2017-2018': 0.45788645788645793, '2016-2017': 0.45788645788645793, '2015-2016': 0.45788645788645793, '2014-2015': 0.45788645788645793, '2013-2014': 0.45788645788645793, '2010-2011': 0.45788645788645793}, {'team': 'Villarreal', '2012-2013': 0.5585585585585585, '2021-2022': 0.45788645788645793, '2020-2021': 0.45788645788645793, '2019-2020': 0.45788645788645793, '2018-2019': 0.45788645788645793, '2017-2018': 0.45788645788645793, '2016-2017': 0.45788645788645793, '2015-2016': 0.45788645788645793, '2014-2015': 0.45788645788645793, '2013-2014': 0.45788645788645793, '2011-2012': 0.45788645788645793, '2010-2011': 0.45788645788645793}, {'team': 'Alcoyano', '2011-2012': 0.3063063063063063, '2021-2022': 0.45788645788645793, '2020-2021': 0.45788645788645793, '2019-2020': 0.45788645788645793, '2018-2019': 0.45788645788645793, '2017-2018': 0.45788645788645793, '2016-2017': 0.45788645788645793, '2015-2016': 0.45788645788645793, '2014-2015': 0.45788645788645793, '2013-2014': 0.45788645788645793, '2012-2013': 0.45788645788645793, '2010-2011': 0.45788645788645793}, {'team': 'Celta', '2011-2012': 0.6486486486486487, '2010-2011': 0.5495495495495496, '2021-2022': 0.45788645788645793, '2020-2021': 0.45788645788645793, '2019-2020': 0.45788645788645793, '2018-2019': 0.45788645788645793, '2017-2018': 0.45788645788645793, '2016-2017': 0.45788645788645793, '2015-2016': 0.45788645788645793, '2014-2015': 0.45788645788645793, '2013-2014': 0.45788645788645793, '2012-2013': 0.45788645788645793}, {'team': 'Villarreal B', '2011-2012': 0.4144144144144144, '2010-2011': 0.42342342342342343, '2021-2022': 0.45788645788645793, '2020-2021': 0.45788645788645793, '2019-2020': 0.45788645788645793, '2018-2019': 0.45788645788645793, '2017-2018': 0.45788645788645793, '2016-2017': 0.45788645788645793, '2015-2016': 0.45788645788645793, '2014-2015': 0.45788645788645793, '2013-2014': 0.45788645788645793, '2012-2013': 0.45788645788645793}, {'team': 'Salamanca', '2010-2011': 0.36936936936936937, '2021-2022': 0.45788645788645793, '2020-2021': 0.45788645788645793, '2019-2020': 0.45788645788645793, '2018-2019': 0.45788645788645793, '2017-2018': 0.45788645788645793, '2016-2017': 0.45788645788645793, '2015-2016': 0.45788645788645793, '2014-2015': 0.45788645788645793, '2013-2014': 0.45788645788645793, '2012-2013': 0.45788645788645793, '2011-2012': 0.45788645788645793}]

    array_de_equipos = getArrayEquipos(array)
    tempMenos1 = getTemporadaAnterior(array[0]['temporada'])
    tempMenos2 = getTemporadaAnterior(tempMenos1)
    arrayDeEquiposConRanking = []
    for equipo in array_de_equipos:
        object = {}
        object['team'] = equipo
        for element in arrayDeClasificacionesHistoricas:
            if element['team'] == equipo:
                object['porcentaje'] = (element[tempMenos1] + element[tempMenos2])/2
                break
        arrayDeEquiposConRanking.append(object)
    return sorted(arrayDeEquiposConRanking, key=lambda x: -x['porcentaje'])

def getElementsDeTemporada(historical, temporada):
    array = []
    for element in historical:
        if element['temporada'] == temporada:
            array.append(element)
    return array


#Funciones generales que permiten ser usadas en todos los nodos
def convertInArray(historical):
    array = []
    for element in historical:
        array.append(element)
    return array

def getArrayEquipos(historico):
    array = []
    for jornada in historico:
        if jornada['homeTeam'] not in array:
            array.append(jornada['homeTeam'])
        if jornada['awayTeam'] not in array:
            array.append(jornada['awayTeam'])
    return array

def getTemporadaAnterior(temporada):
    temporada = temporada.split('-')
    return str(int(temporada[0])-1) + '-' + str(int(temporada[1])-1)

### Funciones que permiten crear los elementos básicos del array
def crearArrayConClasificaciones(historical):
    array = []
    for element in historical:
        array.append(crearElementosBasicosDelObject(element))
    array = sorted(array, key=lambda x: (-x['date'], x['homeTeam'], x['awayTeam']))

    for i in range(0, len(array)):
        array[i]['numero_partido'] = i + 1
        array[i]['node3_goals_expectative'] = 0
    return array


def crearElementosBasicosDelObject(object):
        neoObject = {}
        neoObject['date'] = calcularTiempo(object['Date'])
        neoObject['week'] = getWeek(neoObject['date'])
        neoObject['liga'] = object['liga']
        neoObject['temporada'] = object['temporada']
        neoObject['partido'] = object['HomeTeam'] + ' - ' + object['AwayTeam']
        neoObject['homeTeam'] = object['HomeTeam']
        neoObject['awayTeam'] = object['AwayTeam']
        neoObject['winner'] = object['FTR']
        neoObject['FTHG'] = object['FTHG']
        neoObject['FTAG'] = object['FTAG']
        neoObject['B365D'] = object['B365D']
        neoObject['BWD'] = object['BWD']
        neoObject['WHD'] = object['WHD']
        return neoObject

def calcularTiempo(fecha):
    if len(fecha.split('/')[2]) == 2:
        return datetime.strptime('20' + fecha.split('/')[2] + '-' + fecha.split('/')[1] + '-' + fecha.split('/')[0], "%Y-%m-%d").timestamp()
    return datetime.strptime(fecha.split('/')[2] + '-' + fecha.split('/')[1] + '-' + fecha.split('/')[0], "%Y-%m-%d").timestamp()

def getWeek(fecha):
    # Viernes 2 de Enero de 2009
    initialTime = 1230854400
    multiplicador_cuatro = 86400*4
    multiplicador_tres = 86400*3

    valorActual = initialTime
    for i in range(0, 100000):
        if i % 2 == 0:
            valorActual += multiplicador_tres
        if i % 2 == 1:
            valorActual += multiplicador_cuatro
        if valorActual > fecha:
            return i

### Funciones para el manejo de base de datos
def getHistorical(liga):
    try:
        query = {}
        query['liga'] = liga
        resultado = db.datos_completos.find(query)
        return resultado

    except ImportError:
        platform_specific_module = None
        return ('Ha habido un error')

#main()
